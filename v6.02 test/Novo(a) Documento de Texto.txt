import tkinter as tk
from tkinter import filedialog, ttk
import os
import psutil
import threading
import time
import speedtest
import platform

# Função para obter arquivos do diretório
def listar_arquivos():
    pasta = filedialog.askdirectory()
    if pasta:
        lista_arquivos.delete(0, tk.END)
        for item in os.listdir(pasta):
            lista_arquivos.insert(tk.END, item)

# Atualiza dados do sistema
def atualizar_dados():
    while True:
        # CPU e RAM
        cpu = psutil.cpu_percent(interval=1)
        ram = psutil.virtual_memory().percent

        # Temperatura (só Linux com suporte)
        try:
            temps = psutil.sensors_temperatures()
            if "coretemp" in temps:
                temp = temps["coretemp"][0].current
            elif "cpu-thermal" in temps:
                temp = temps["cpu-thermal"][0].current
            else:
                temp = "N/A"
        except:
            temp = "N/A"

        # Internet (upload/download)
        net = psutil.net_io_counters()
        download = net.bytes_recv / 1024 / 1024  # MB
        upload = net.bytes_sent / 1024 / 1024

        # Atualiza na interface
        lbl_cpu.config(text=f"Uso de CPU: {cpu:.1f}%")
        lbl_ram.config(text=f"Uso de RAM: {ram:.1f}%")
        lbl_temp.config(text=f"Temperatura: {temp} °C")
        lbl_net.config(text=f"Download: {download:.2f} MB | Upload: {upload:.2f} MB")

        time.sleep(2)

# Teste de velocidade (internet)
def testar_velocidade():
    lbl_speed.config(text="Testando velocidade...")
    st = speedtest.Speedtest()
    down = st.download() / 1024 / 1024
    up = st.upload() / 1024 / 1024
    lbl_speed.config(text=f"Velocidade - Down: {down:.2f} Mbps | Up: {up:.2f} Mbps")

# GUI
janela = tk.Tk()
janela.title("Monitor de Sistema")
janela.geometry("700x500")
janela.resizable(False, False)

# Seção: Arquivos
frame_arquivos = ttk.LabelFrame(janela, text="Gerenciador de Arquivos")
frame_arquivos.pack(fill="x", padx=10, pady=10)

btn_abrir = ttk.Button(frame_arquivos, text="Abrir Pasta", command=listar_arquivos)
btn_abrir.pack(padx=5, pady=5)

lista_arquivos = tk.Listbox(frame_arquivos, height=6)
lista_arquivos.pack(fill="x", padx=5, pady=5)

# Seção: Monitoramento
frame_monitor = ttk.LabelFrame(janela, text="Monitoramento do Sistema")
frame_monitor.pack(fill="x", padx=10, pady=10)

lbl_cpu = ttk.Label(frame_monitor, text="Uso de CPU:")
lbl_cpu.pack(anchor="w", padx=5)

lbl_ram = ttk.Label(frame_monitor, text="Uso de RAM:")
lbl_ram.pack(anchor="w", padx=5)

lbl_temp = ttk.Label(frame_monitor, text="Temperatura:")
lbl_temp.pack(anchor="w", padx=5)

lbl_net = ttk.Label(frame_monitor, text="Uso de Internet:")
lbl_net.pack(anchor="w", padx=5)

# Seção: Teste de velocidade
frame_speed = ttk.LabelFrame(janela, text="Teste de Velocidade da Internet")
frame_speed.pack(fill="x", padx=10, pady=10)

btn_speed = ttk.Button(frame_speed, text="Testar Velocidade", command=lambda: threading.Thread(target=testar_velocidade).start())
btn_speed.pack(pady=5)

lbl_speed = ttk.Label(frame_speed, text="Velocidade - Down: ... | Up: ...")
lbl_speed.pack(anchor="center", padx=5)

# Thread para atualizar dados
threading.Thread(target=atualizar_dados, daemon=True).start()

# Rodar GUI
janela.mainloop()
